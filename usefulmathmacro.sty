% refer to https://tug.org/TUGboat/tb31-1/tb97wright-xparse.pdf
\NeedsTeXFormat{LaTeX2e}[2019-10-01]
\ProvidesPackage{usefulmathmacro}[2021/05/01 Provides some useful math commands]

\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{amsthm}
\RequirePackage{xparse}

% sets
\ProvideDocumentCommand{\real}{O{}}{
    \mathbb{R}^{#1}
}
\providecommand{\RR}{\real} %alias
\ProvideDocumentCommand{\complex}{O{}}{
    \mathbb{C}^{#1}
}
\providecommand{\CC}{\complex} %alias
\ProvideDocumentCommand{\integer}{O{}}{
    \mathbb{Z}^{#1}
}
\providecommand{\ZZ}{\integer} %alias
\ProvideDocumentCommand{\naturalNumber}{O{}}{
    \mathbb{N}^{#1}
}
\providecommand{\NN}{\naturalNumber} %alias
\ProvideDocumentCommand{\rationalNumber}{O{}}{
    \mathbb{Q}^{#1}
}
\providecommand{\QQ}{\rationalNumber} %alias
\ProvideDocumentCommand{\positiveReal}{}{
    \real[+]
}
\ProvideDocumentCommand{\nonnegativeReal}{s}{
    [0, \infty \IfBooleanTF{#1}{]}{)}
}
\ProvideDocumentCommand{\realHalfSpace}{O{}}{
    \real[#1]_+
}
\ProvideDocumentCommand{\positiveInteger}{}{
    \integer[+]
}
\ProvideDocumentCommand{\matrixSpace}{m m o}{
    {M_{{#1} \times {#2}}} \IfNoValueF{#3}{\! \left( {#3} \right)}
}
\ProvideDocumentCommand{\scalarMatrix}{m m m}{
    {#1}^{{#2} \times {#3}}
}
\ProvideDocumentCommand{\torus}{O{}}{
    \mathbb{T}^{#1}
}
\ProvideDocumentCommand{\setBuilder}{s O{|} m o}{ 
    % TODO: need better fix for line breaking if #2 or #3 is too long
    \IfBooleanTF{#1}{
        \IfNoValueTF{#4}{ \left\{ #3 \right\} }{ \left\{ #3 \middle#2 #4 \right\} }
    }{
        \IfNoValueTF{#4}{
            \left\{ \protect\vphantom{#3} \right.
            #3 
            \left. \protect\vphantom{#3} \right\}  
        }{
            \left\{ \protect\vphantom{#3 #4} \right.\! #3 
            \left. \protect\vphantom{#3} \middle#2 \protect\vphantom{#4} \right.
            \allowbreak
            #4 \!\left. \protect\vphantom{#3 #4} \right\}
        }
    }
}
\ProvideDocumentCommand{\funcDef}{m m m}{
    {#1} : {#2} \rightarrow {#3}
}

% geometric/topological sets
\ProvideDocumentCommand{\metricBall}{O{1} o}{
    {B_{#1}} \IfNoValueF{#2}{\!\left( {#2} \right)}
}
\ProvideDocumentCommand{\closedMetricBall}{O{1} o}{
    \overline{\metricBall[#1][#2]}
}
\ProvideDocumentCommand{\boundary}{m}{
    \partial #1
}
\ProvideDocumentCommand{\unitSphere}{O{1}}{
    S^{#1}
}

% usual functions
\ProvideDocumentCommand{\abs}{s m}{
    \IfBooleanTF{#1}{
        \left| #2 \right|
    }{
        \left| \protect\vphantom{#2} \right. \!
        {#2}
        \! \left. \protect\vphantom{#2} \right|
    }
}
\ProvideDocumentCommand{\norm}{s O{} m}{
    \IfBooleanTF{#1}{
        \left\| #3 \right\|_{#2}
    }{
        \left\| \protect\vphantom{#3} \right. \!
        {#3}
        \! \left. \protect\vphantom{#3} \right\|_{#2}
    }
}
\ProvideDocumentCommand{\opNorm}{s m}{
    \IfBooleanTF{#1}{\norm*}{\norm}[\text{op}]{#2}
}
\ProvideDocumentCommand{\innerProd}{m m}{
    \left\langle {#1} , \, {#2} \right\rangle
}
\ProvideDocumentCommand{\evalAt}{m m}{
    {
        \left. 
            {#1} 
        \right|_{#2}
    }
}
\ProvideDocumentCommand{\trace}{o}{
    \mathrm{tr} \IfNoValueTF{#1}{\,}{\! \left( #1 \right)}
}
\ProvideDocumentCommand{\inv}{O{1} m}{
    {{#2}^{-#1}}
}
\ProvideDocumentCommand{\normalized}{O{\abs} m}{
    \frac{#2}{#1{#2}}
}
\ProvideDocumentCommand{\transpose}{O{\mathsf{T}} m}{
    {#2}^{#1}
}
\ProvideDocumentCommand{\limit}{s m o}{
    \IfBooleanTF{#1}{
        \lim_{{#2} \IfNoValueF{#3}{\to {#3}}}
    }{
        \lim\limits_{{#2} \IfNoValueF{#3}{\to {#3}}}
    }
}
\ProvideDocumentCommand{\tensorPower}{O{2} m}{
    {#2}^{\otimes {#1}}
}
\ProvideDocumentCommand{\ceil}{s m}{
    \IfBooleanTF{#1}{
        \left\lceil #2 \right\rceil
    }{
        \left\lceil \protect\vphantom{#2} \right. \!
        {#2}
        \! \left. \protect\vphantom{#2} \right\rceil
    }
}
\ProvideDocumentCommand{\floor}{s m}{
    \IfBooleanTF{#1}{
        \left\lfloor #2 \right\rfloor
    }{
        \left\lfloor \protect\vphantom{#2} \right. \!
        {#2}
        \! \left. \protect\vphantom{#2} \right\rfloor
    }
}
\ProvideDocumentCommand{\support}{o}{
    \mathrm{supp} \IfNoValueF{#1}{\, #1}
}
\ProvideDocumentCommand{\indicator}{s m}{
    {\IfBooleanTF{#1}{\mathbf{1}}{\chi}_{#2}}
}

% usual differential operators - function
\ProvideDocumentCommand{\derivativeD}{O{}}{
    \mathrm{D}^{#1}
}
\ProvideDocumentCommand{\ordinaryD}{m O{}}{
    \frac{\mathrm{d} {#2}}{\mathrm{d} {#1}}
}
\providecommand{\od}[1]{\ordinaryD{#1}[]}
\ProvideDocumentCommand{\partialD}{O{} O{}}{
    {\partial_{#1}^{#2}}
}
\providecommand{\pd}[1]{\partialD{#1}[]}
\ProvideDocumentCommand{\partialDFrac}{m O{}}{
    \frac{\partial {#2}}{\partial {#1}}
}
\ProvideDocumentCommand{\normalD}{O{}}{
    \partialDFrac{n}[#1]
}
\ProvideDocumentCommand{\laplacian}{O{} O{}}{
    {\Delta_{#1}^{#2}}
}

% usual differential operators - vector
\ProvideDocumentCommand{\grad}{O{} O{}}{
    {\nabla_{#1}^{#2}}
}
\ProvideDocumentCommand{\gradText}{}{
    \mathrm{grad}
}
\ProvideDocumentCommand{\divergence}{O{}}{
    \nabla_{#1} \! \cdot
}
\ProvideDocumentCommand{\divergenceD}{O{}}{
    \partial_{#1} \! \cdot
}
\ProvideDocumentCommand{\divergenceText}{}{
    \mathrm{div}
}
\ProvideDocumentCommand{\curl}{O{}}{
    {\nabla_{#1} \! \times \!}
}
\ProvideDocumentCommand{\curlText}{}{
    \mathrm{curl}
}
\ProvideDocumentCommand{\dirac}{s >{\SplitList{ ; }}m}{
    \begingroup
    \newcommand{\ummTempDirac}[1]{\delta_{##1}}
    \newcommand{\ummTempDiracTwo}[2]{\delta_{##1}^{##2}}
    \NewDocumentCommand{\ummTempSplitThenDirac}{>{\SplitArgument{1}{ , }}m}{
        \ummTempDiracTwo ##1
    }
    \IfBooleanTF{#1}{
        \ProcessList{#2}{\ummTempSplitThenDirac}
    }{
        \ProcessList{#2}{\ummTempDirac}
    }
    \endgroup
}

% usual differential operators - integral
\ProvideDocumentCommand{\integralVar}{m}{
    \mathrm{d} {#1}
}

% function classes
\ProvideDocumentCommand{\continuousFunc}{O{0} O{} o o}{
    {\mathit{C}_{#2}^{#1}} \IfNoValueF{#3}{
        \negmedspace \left(
        {#3}
        \IfNoValueF{#4}{\,;\, {#4}}
        \right)
    }
}
\ProvideDocumentCommand{\smoothFunc}{O{} o o}{
    \continuousFunc[\infty][#1][#2][#3]
}
\ProvideDocumentCommand{\analyticFunc}{O{} o o}{
    \continuousFunc[\omega][#1][#2][#3]
}
\ProvideDocumentCommand{\lpFunc}{m O{} o o}{
    {\mathit{L}_{#2}^{#1}} \IfNoValueF{#3}{
        \negmedspace \left(
        {#3}
        \IfNoValueF{#4}{\,;\, {#4}}
        \right)
    }
}
\ProvideDocumentCommand{\sobolevFunc}{m m O{} o}{
    {\mathit{W}_{#3}^{#1, #2}} \IfNoValueF{#4}{\negmedspace \left( {#4} \right)}
}
\ProvideDocumentCommand{\sobolevHFunc}{m O{} o}{
    {\mathit{H}_{#2}^{#1}} \IfNoValueF{#3}{\negmedspace \left( {#3} \right)}
}

% complexity
\ProvideDocumentCommand{\bigO}{m}{
    \mathcal{O}\!\left( {#1} \right)
}
\ProvideDocumentCommand{\smallO}{m}{
    o\!\left( {#1} \right)
}
\ProvideDocumentCommand{\bigOmega}{m}{
    \Omega\!\left( {#1} \right)
}
\ProvideDocumentCommand{\smallOmega}{m}{
    \omega\!\left( {#1} \right)
}
\ProvideDocumentCommand{\bigTheta}{m}{
    \Theta\!\left( {#1} \right)
}

% environments
% TODO put #1 in ref part too (e.g. clickable with hyperref)
\ProvideDocumentEnvironment{labledproof}{o m +b}{
    \begin{proof}[Proof of 
        \IfNoValueTF{#1}
        {\ifcsname autoref\endcsname\autoref{#2}\else Theorem \ref{#2}\fi}
        {#1 \ref{#2}}]
        #3
    \end{proof}
}{}
