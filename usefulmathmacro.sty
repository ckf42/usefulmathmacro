% refer to https://tug.org/TUGboat/tb31-1/tb97wright-xparse.pdf
\NeedsTeXFormat{LaTeX2e}[2019-10-01]
\ProvidesPackage{usefulmathmacro}[2021/05/01 Provides some useful math commands]

\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{amsthm}
\RequirePackage{xparse}

% auxuily helper function
% TODO:
%     currently mid-delim can only be a delimiter (e.g. \vert)
%     but common choices for this may not be delimiters (e.g. :)
%     the current way is to prefix with a dot (.) 
%     but then it would not size with \left \right (not sure if it should)
%     there may be other symbols that have the same issue
% 1:star 2:{left-delim} 3:[mid-delim] 4:{right-delim} 5:{content} 6:[second-content]
\ProvideDocumentCommand{\ummGeneralBracket}{s m o m m o}{ 
    \IfBooleanTF{#1}{
        \IfNoValueTF{#6}{ \left#2 #5 \right#4 }{ \left#2 #5 \middle#3 #6 \right#4 }
    }{
        \IfNoValueTF{#6}{
            \left#2 \protect\vphantom{#5} \right.
            #5 
            \left. \protect\vphantom{#5} \right#4 
        }{
            \left#2 \protect\vphantom{#5 #6} \right. #5 
            \left. \protect\vphantom{#5} \middle#3 \protect\vphantom{#6} \right.
            \allowbreak
            #6 \left. \protect\vphantom{#5 #6} \right#4
        }
    }
}
% 1:[name] 2:{dom} 3:[codom]
\ProvideDocumentCommand{\ummHomSet}{O{\mathrm{Hom}} m o}{
    {#1 (#2 \IfNoValueF{#3}{, #3})}
}
% 1:{sym} 2:{lower} 3:[upper]
\ProvideDocumentCommand{\ummFuncClass}{m m o}{
    {{#1}_{\IfNoValueF{#3}{\,#3}}^{#2}}
}

% brackets
\ProvideDocumentCommand{\parenth}{s r()}{
    \IfBooleanTF{#1}{\ummGeneralBracket*}{\ummGeneralBracket}{(}{)}{#2}
}
\ProvideDocumentCommand{\chevron}{s m}{
    \IfBooleanTF{#1}{\ummGeneralBracket*}{\ummGeneralBracket}{\langle}{\rangle}{#2}
}
\ProvideDocumentCommand{\bracket}{s r[]}{
    \IfBooleanTF{#1}{\ummGeneralBracket*}{\ummGeneralBracket}{[}{]}{#2}
}
\ProvideDocumentCommand{\braces}{s m}{
    \IfBooleanTF{#1}{\ummGeneralBracket*}{\ummGeneralBracket}{\{}{\}}{#2}
}

% common functions
\ProvideDocumentCommand{\abs}{s m}{
    \IfBooleanTF{#1}{\ummGeneralBracket*}{\ummGeneralBracket}{|}{|}{#2}
}
\ProvideDocumentCommand{\norm}{s m}{
    \IfBooleanTF{#1}{\ummGeneralBracket*}{\ummGeneralBracket}{\|}{\|}{#2}
}
\ProvideDocumentCommand{\innerProd}{s m m}{
    \IfBooleanTF{#1}{ \parenth({#2}, \, {#3}) }{ \chevron{{#2}, \, {#3}} }
}
\ProvideDocumentCommand{\ceil}{s m}{
    \IfBooleanTF{#1}{\ummGeneralBracket*}{\ummGeneralBracket}{\lceil}{\rceil}{#2}
}
\ProvideDocumentCommand{\floor}{s m}{
    \IfBooleanTF{#1}{\ummGeneralBracket*}{\ummGeneralBracket}{\lfloor}{\rfloor}{#2}
}
\ProvideDocumentCommand{\evalAt}{m m}{
    {\ummGeneralBracket{.}{|}{#2}_{#1}}
}
\ProvideDocumentCommand{\inv}{O{1} m}{
    {{#2}^{-#1}}
}
\ProvideDocumentCommand{\normalized}{O{\abs} m}{
    \frac{#2}{#1{#2}}
}
\ProvideDocumentCommand{\summation}{s m m m}{
    \sum\IfBooleanT{#1}{\limits}_{#2 = #3}^{#4}
}
\ProvideDocumentCommand{\product}{s m m m}{
    \prod\IfBooleanT{#1}{\limits}_{#2 = #3}^{#4}
}
\providecommand{\conju}[1]{ \overline{#1} }
\ProvideDocumentCommand{\limit}{s m o}{
    \IfBooleanTF{#1}{
        \lim_{{#2} \IfNoValueF{#3}{\to {#3}}}
    }{
        \lim\limits_{{#2} \IfNoValueF{#3}{\to {#3}}}
    }
}

% common objects
\ProvideDocumentCommand{\idenMap}{O{}}{
    {\mathrm{Id}_{#1}}
}
\ProvideDocumentCommand{\indicator}{o}{ {\chi_{#1}} }
\providecommand{\oo}{\infty}
\ProvideDocumentCommand{\halfOf}{O{1}}{ {\frac{#1}{2}} }
\ProvideDocumentCommand{\half}{O{1}}{ \halfOf[#1] } % compatibility
\providecommand{\oneOver}[1]{ \frac{1}{ #1 } }

% numbers
\providecommand{\real}{ \mathbb{R} }
\providecommand{\RR}{ \real } %alias
\providecommand{\complex}{ \mathbb{C} }
\providecommand{\CC}{ \complex } %alias
\providecommand{\integer}{ \mathbb{Z} }
\providecommand{\ZZ}{ \integer } %alias
\providecommand{\naturalNumber}{ \mathbb{N} }
\providecommand{\NN}{ \naturalNumber } %alias
\providecommand{\rational}{ \mathbb{Q} }
\providecommand{\QQ}{ \rational } %alias

% numbers - variant
\ProvideDocumentCommand{\positiveReal}{s}{
    \IfBooleanTF{#1}{
        (0, \infty] 
    }{
        \real^+
    }
}
\ProvideDocumentCommand{\nonnegativeReal}{s}{
    \IfBooleanTF{#1}{
        [0, \infty] 
    }{
        [0, \infty)
    }
}
\providecommand{\positiveInteger}{ {\integer^+} }

% common sets
\ProvideDocumentCommand{\torus}{O{}}{ {\mathbb{T}^{#1}} }
\ProvideDocumentCommand{\unitSphere}{O{1}}{ {S^{#1}} }
% \providecommand{\integerRange}[2]{ \braces{#1, \ldots, #2} }
\ProvideDocumentCommand{\integerRange}{s m m}{
    \IfBooleanTF{#1}{\braces*}{\braces}{#1, \ldots, #2}
}
\ProvideDocumentCommand{\setBuilder}{s O{|} m o}{ 
    \IfBooleanTF{#1}{\ummGeneralBracket*}{\ummGeneralBracket}{\{}[#2]{\}}{#3}[#4]
}

% matrix sets
\providecommand{\matrixSpace}[2]{ {M_{{#1} \times {#2}}} }
\providecommand{\generalLinearGp}[1]{ \ummHomSet[\mathrm{GL}]{#1} }
\providecommand{\specialLinearGp}[1]{ \ummHomSet[\mathrm{SL}]{#1} }
\providecommand{\orthogonalGp}[1]{ \ummHomSet[\mathrm{O}]{#1} }
\providecommand{\specialOrthogonalGp}[1]{ \ummHomSet[\mathrm{SO}]{#1} }
\providecommand{\unitaryGp}[1]{ \ummHomSet[\mathrm{U}]{#1} }
\providecommand{\specialUnitaryGp}[1]{ \ummHomSet[\mathrm{SU}]{#1} }

% linear algebra
\ProvideDocumentCommand{\spanSet}{s m}{
    \mathrm{Span} \!
    \IfBooleanTF{#1}{\parenth*}{\parenth}(#2)
}
\ProvideDocumentCommand{\spanSetOfEle}{s m}{
    \IfBooleanTF{#1}{\spanSet*}{\spanSet}{\setBuilder{#2}}
}
\ProvideDocumentCommand{\colVect}{O{p} >{\SplitList { ; }}m}{
    \begingroup
    \newcommand{\ummTempAddLineBreakAfter}[1]{##1 \\}
    \begin{#1matrix}
        \ProcessList{#2}{\ummTempAddLineBreakAfter}
    \end{#1matrix}
    \endgroup
}
\ProvideDocumentCommand{\tensorPower}{O{2} m}{
    {{#2}^{\otimes {#1}}}
}
\providecommand{\transpose}{ \mathsf{T} }
\providecommand{\conjuTranspose}{ \mathsf{H} }
\ProvideDocumentCommand{\idenMatrix}{O{}}{ {I_{#1}} }
\DeclareMathOperator{\nullity}{nullity}
\DeclareMathOperator{\trace}{tr}
\DeclareMathOperator{\rank}{rank}
\providecommand{\nullSpace}[1]{
    \mathsf{N}\parenth(#1)
}
\providecommand{\range}[1]{
    \mathsf{R}\parenth(#1)
}
\ProvideDocumentCommand{\dirac}{s >{\SplitList{ ; }}m}{
    \begingroup
    \newcommand{\ummTempDirac}[1]{\delta_{##1}}
    \newcommand{\ummTempDiracTwo}[2]{\delta_{##1}^{##2}}
    \NewDocumentCommand{\ummTempSplitThenDirac}{>{\SplitArgument{1}{ , }}m}{
        \ummTempDiracTwo ##1
    }
    \IfBooleanTF{#1}{
        \ProcessList{#2}{\ummTempSplitThenDirac}
    }{
        \ProcessList{#2}{\ummTempDirac}
    }
    \endgroup
}

% complexity classes
\providecommand{\bigO}[1]{ \mathcal{O}\!\parenth(#1) }
\providecommand{\smallO}[1]{ o\!\parenth(#1) }
\providecommand{\bigOmega}[1]{ \Omega\!\parenth(#1) }
\providecommand{\smallOmega}[1]{ \omega\!\parenth(#1) }
\providecommand{\bigTheta}[1]{ \Theta\!\parenth(#1) }

% arrow aliases
\providecommand{\surjTo}{ \twoheadrightarrow }
\providecommand{\injTo}{ \hookrightarrow }
\providecommand{\bijTo}{ \leftrightarrow }
\providecommand{\weakTo}{ \rightharpoonup }
\providecommand{\unifTo}{ \rightrightarrows }

% operators
\DeclareMathOperator{\support}{supp}
\DeclareMathOperator{\sgn}{sgn}
\DeclareMathOperator{\image}{Im}

% calculus operators
\ProvideDocumentCommand{\ordinaryD}{s o m o}{
    \IfBooleanTF{#1}{
        \frac{\mathrm{d}^{\IfNoValueF{#2}{#2}} \IfNoValueF{#4}{#4}}{{\mathrm{d} #3}^{\IfNoValueF{#2}{#2}}}
    }{
        \frac{\mathrm{d}^{\IfNoValueF{#2}{#2}}}{{\mathrm{d} #3}^{\IfNoValueF{#2}{#2}}} \IfNoValueF{#4}{#4}
    }
}
\providecommand{\od}[1]{\ordinaryD{#1}}
\ProvideDocumentCommand{\partialD}{s o m o}{
    \IfBooleanTF{#1}{
        \frac{\partial^{\IfNoValueF{#2}{#2}} \IfNoValueF{#4}{#4}}{{\partial #3}^{\IfNoValueF{#2}{#2}}}
    }{
        \frac{\partial^{\IfNoValueF{#2}{#2}}}{{\partial #3}^{\IfNoValueF{#2}{#2}}} \IfNoValueF{#4}{#4}
    }
}
\providecommand{\pd}[1]{\partialD{#1}}
\ProvideDocumentCommand{\grad}{s O{}}{
    \IfBooleanTF{#1}{
        \mathrm{grad} \!
    }{
        \nabla_{#2}
    }
}
\ProvideDocumentCommand{\divergence}{s O{}}{
    \IfBooleanTF{#1}{
        \mathrm{div} \!
    }{
        \grad[#2] \cdot
    }
}
\ProvideDocumentCommand{\curl}{s O{}}{
    \IfBooleanTF{#1}{
        \mathrm{curl} \!
    }{
        \grad[#2] \times \!
    }
}
\providecommand{\integral}[2]{ {\int_{#1}^{#2}} }
\providecommand{\dd}[1]{ \mathrm{d}{#1} }
\ProvideDocumentCommand{\integralVar}{>{\SplitList{ ; }}m}{
    \begingroup
    \newcommand{\ummTempIntVarLst}[1]{\dd{##1}}
    \,\ProcessList{#1}{\ummTempIntVarLst}
    \endgroup
}
\providecommand{\integration}[4]{ \integral{#2}{#3} #4 \integralVar{#1} }

% function spaces
\ProvideDocumentCommand{\continuousFunc}{O{0} o}{
    \ummFuncClass{\mathit{C}}{#1}[#2]
}
\ProvideDocumentCommand{\smoothFunc}{o}{
    \ummFuncClass{\mathit{C}}{\infty}[#1]
}
\ProvideDocumentCommand{\analyticFunc}{o}{
    \ummFuncClass{\mathit{C}}{\omega}[#1]
}
\ProvideDocumentCommand{\lpFunc}{m o}{
    \ummFuncClass{\mathit{L}}{#1}[#2]
}
\ProvideDocumentCommand{\sobolevWFunc}{m m o}{
    \ummFuncClass{\mathit{W}}{{#1}, {#2}}[#3]
}
\ProvideDocumentCommand{\sobolevHFunc}{m o}{
    \ummFuncClass{\mathit{H}}{#1}[#2]
}
\ProvideDocumentCommand{\polyFunc}{o o}{
    {\mathsf{P}_{#1} \IfNoValueF{#2}{(#2)}}
}

% probabilty
\ProvideDocumentCommand{\prob}{m o}{
    \mathrm{P}\ummGeneralBracket*{(}[|]{)}{#1}[#2]
}
\ProvideDocumentCommand{\expect}{m o}{
    \mathbb{E}\ummGeneralBracket*{[}[|]{]}{#1}[#2]
}

